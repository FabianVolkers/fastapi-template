# windbox-config-service

Config service as RESTful API for the WindBox project. Built with FastAPI

## Contents

- [windbox-config-service](#windbox-config-service)
  - [Contents](#contents)
  - [API Documentation](#api-documentation)
  - [Development environment](#development-environment)
    - [Bootstrap development environment](#bootstrap-development-environment)
      - [Install poetry](#install-poetry)
      - [Install dependencies](#install-dependencies)
      - [Setup db](#setup-db)
    - [Setup the database](#setup-the-database)
    - [Run the development server](#run-the-development-server)
    - [Development tools](#development-tools)
      - [Testing](#testing)
      - [Linting](#linting)
      - [Formatting](#formatting)


## API Documentation

The API documentation is autogenerated using the OpenAPI specification. It can be viewed [here](https://config-service.windreserve.de/docs), _as soon as it's deployed_. Alternatively, you can [run the development server](#run-the-development-server) and view the docs locally at [http://127.0.0.1/docs](http://127.0.0.1/docs).

## Development environment

We use [poetry](https://python-poetry.org/) to manage the development environment including project dependencies and scripts. We have defined a number of scripts in `pyproject.toml` to simplify the development experience. See below for more details.

### Bootstrap development environment

You can use [make](https://linux.die.net/man/1/make) with the included `Makefile` to bootstrap the development environment. This will install poetry, use poetry to install dependencies and setup the database. Alternatively, you can use the steps outlined below to perform these actions manually.

```zsh
make bootstrap
```

#### Install poetry

```zsh
ln -s /etc/ssl/* /Library/Frameworks/Python.framework/Versions/3.8/etc/openssl 
curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/install-poetry.py | python3 -
```

#### Install dependencies

To install the dependencies defined in `pyproject.toml` simply run `poetry install`.

#### Setup db

See [below](#setup-the-database) for info.

### Setup the database

[Alembic](https://alembic.sqlalchemy.org/en/latest/) is configured to manage database migrations. Initialise a new database or update an existing one using `poetry run setup-db`

### Run the development server

```zsh
poetry run start
```

The API will be accessible at [http://127.0.0.1:8000](http://127.0.0.1:8000), with the autogenerated docs available at [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs).

### Development tools

The following tools are set up and integrated into poetry to enable testing as well as enforce style guides and linting rules. The defined poetry scripts can be found inside `pyproject.toml`. They all execute functions defined in `main.py`.

#### Testing

Tests are executed using [pytest](https://docs.pytest.org/en/6.2.x/). You can run pytest using `poetry run test`.

#### Linting

[flake8](https://flake8.pycqa.org/en/latest/) is configured for linting our code. Invoke the linter using `poetry run lint`.

#### Formatting

[isort](https://pycqa.github.io/isort/) and [autopep8](https://pypi.org/project/autopep8/) are set up to format the code and enforce style guides. Run both at once using `poetry run format`.
